import{Player as e,system as t,world as o}from"@minecraft/server";import{ActionFormData as i,ModalFormData as a}from"@minecraft/server-ui";import{warps as r}from"./warpsapi";import{baseConfigMenu as l}from"./configuratorOptions";import{Database as n}from"./db";import{ActionForm as s,MessageForm as p,ModalForm as f}from"./form_func";import{isAdmin as m}from"./isAdmin";import{openShopUI as u}from"./shopui";import{uiManager as d}from"./uis";import c from"./icons";import{openConfigUI as y}from"./configuratorBase";import{OptionTypes as g,options22 as b}from"./configuratorOptions22";import{DynamicPropertyDatabase as w}from"./dynamicPropertyDb";import{worldTags as h}from"./apis/WorldTags";o.afterEvents.playerSpawn.subscribe((e=>{})),o.afterEvents.playerLeave.subscribe((e=>{if(WelcomeMessageEnabled)for(const e of o.getPlayers())e.playSound("note.bit",{pitch:.5})})),o.beforeEvents.itemUse.subscribe((i=>{i.source instanceof e&&t.run((()=>{if("azalea:floating_text_editor"==i.itemStack.typeId){let e=h.getTags().filter((e=>e.startsWith("floating_text:"))).map((e=>e.replace("floating_text:",""))),t=[];for(const i of e)try{let e=o.getEntity(i);if(!e)continue;t.push(e)}catch{}let a=new s;for(const e of t)a.button(e.nameTag,null,(t=>{let o=new f;o.title("Code Editor"),o.textField("M","Type some text...",e.nameTag),o.show(t,!1,((t,o)=>{(o.formValues[0]||o.formValues[0].toLowerCase().includes("trash"))&&(e.nameTag=o.formValues[0])}))}));a.show(i.source,!1,((e,t)=>{}))}"azalea:player_shop"==i.itemStack.typeId&&d.open("Azalea0.9.1/PlayerShop/Main",i.source),"azalea:boost_feather"==i.itemStack.typeId&&i.source.applyKnockback(i.source.getViewDirection().x,i.source.getViewDirection().z,2.5,1.5),"azalea:tp_requests"==i.itemStack.typeId&&d.open("Azalea2.0/TeleportRequests/Root",i.source),"azalea:warp"==i.itemStack.typeId&&d.open("Azalea1.1/Warps",i.source),"azalea:shop"==i.itemStack.typeId&&u(i.source),"azalea:config_ui"==i.itemStack.typeId&&t.run((()=>{function e(e,t){let o=new f;o.title(t.title);let i=new n("Config"),a=i.allData;for(const e of t.options)if(e.type==g.Dropdown){let t=a[e.id]?a[e.id]:e.default?e.default:"unknownkey",i=e.keys.indexOf(t),r=(e.display[e.keys.indexOf(t)],["Select an option...",...e.display]);o.dropdown(e.label,r.map((e=>({callback(){},option:e}))),i+1)}else if(e.type==g.Slider){let t="string"==typeof a[e.id]&&a[e.id].startsWith("NUM:")?parseInt(a[e.id].substring(4)):null,i=e.min?e.min:1,r=e.max?e.max:10,l=e.step?e.step:1,n=t||(e.default?e.default:i);o.slider(e.label,i,r,l,n)}else if(e.type==g.Toggle){let t=a[e.id]&&"string"==typeof a[e.id]?"true"==a[e.id]:!!e.default&&e.default;o.toggle(e.label,t)}else if(e.type==g.TextField){let t=a[e.id]?a[e.id]:e.default?e.default:void 0;o.textField(e.label,e.placeholder?e.placeholder:"Type something...",t)}o.show(e,!1,((e,o)=>{let r=-1;for(const e of o.formValues){r++;let o=t.options[r];o.type==g.Toggle?a[o.id]=e?"true":"false":o.type==g.Dropdown?a[o.id]=e?0==e?null:o.keys[e-1]:null:o.type==g.TextField?a[o.id]=e||null:o.type==g.Slider&&(a[o.id]=e?`NUM:${e}`:`NUM:${min}`)}for(const e in a)i.set(e,a[e])}))}!function t(o,i){let a=new s;a.title(`${i.title?i.title:"Config"} §7- §bV${i.version}`);for(const r of i.options)r.permRequired&&!m(o,r.permRequired)||a.button(`${r.name}${r.subtext?`\n§7${r.subtext}`:""}`,r.icon?r.icon:null,(o=>{"panel"==r.type?t(o,r.panel):"options_menu"==r.type?e(o,r.panel):r.type==g.ui&&d.open(r.ui,o)}));a.show(o,!1,((e,t)=>{}))}(i.source,b)}))}))}));