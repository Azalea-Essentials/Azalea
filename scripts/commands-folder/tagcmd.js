import{world as e}from"@minecraft/server";import{commands as t}from"../commands";import{Database as a}from"../db";import{isAdmin as n}from"../isAdmin";export default function r(){t.use(((t,r,d,o,m,i,s,c)=>{try{let m=new a("TagCmdConfig"),s=JSON.parse(m.get("Cmds")?m.get("Cmds"):"[]");if(t)return s.map((e=>({name:e.name,description:e.description?e.description:"No description",category:e.category?e.category:"Uncategorized"})));let c=s.find((e=>e.name==r)),g=s.findIndex((e=>e.name==r));if(!c)return!1;if(o.length&&"/manage"==o[0]){if(!n(d.sender))return void i("ERROR You require admin to perform this action!");switch(o[1]){case"set-description":s[g].description=o.slice(2).join(" "),m.set("Cmds",JSON.stringify(s));break;case"set-category":s[g].category=o.slice(2).join(" "),m.set("Cmds",JSON.stringify(s));break;case"toggle-exec-other":s[g].execOther?s[g].execOther=!1:s[g].execOther=!0,i("SUCCESS Execute on other players mode "+(s[g].execOther?"ENABLED":"DISABLED")),m.set("Cmds",JSON.stringify(s));break;default:i("ERROR Invalid config option!")}return!0}if(s[g].execOther){if(!o.length)return i("ERROR Please include a player name!"),!0;let t,a=o.join(" ");for(const n of e.getPlayers())n.name.toLowerCase()==a.toLowerCase()&&(t=n);if(!t)return i("ERROR Player not found! Make sure they are online and that you spelled the username correctly."),!0;try{t.addTag(c.tag)}catch{}try{d.sender.addTag(`${c.tag}_sender`)}catch{}}else d.sender.addTag(`${c.tag}`);return!0}catch{return!1}})),t.addCommand("tagcmd",{description:"Create custom commands using commands",category:"Customization",usage:"\n!tagcmd add <name> <tag>\n!tagcmd remove <name>\n!tagcmd",admin:!0,onRun(e,r,d,o){let m=new a("TagCmdConfig");if(m.get("Cmds")||m.set("Cmds",JSON.stringify([{name:"tagcmd-help",description:"Get help with tagcmd when its done",category:"Help Center",tag:"azalea:tagcmd-help"}])),!r.length){let t=JSON.parse(m.get("Cmds")?m.get("Cmds"):"[]"),a=[];a.push(`${d.category}<-=- ${d.command}Tagcmd List ${d.category}-=->`);for(const e of t)a.push(`${d.command}${e.name} ${d.description}${e.description} ${d.alias}${e.tag}`);return n(e.sender)&&(a.push(""),a.push(`${d.description}To remove a command: ${d.command}!tagcmd remove <name>`),a.push(`${d.description}To add a command: ${d.command}!tagcmd add <name> <tag>`)),o(`TEXT ${a.join("\n")}`)}{let e=JSON.parse(m.get("Cmds")?m.get("Cmds"):"[]");switch(r[0]){case"add":if(r.length<3)return o("ERROR You must include a command name and tag name");if(t._cmds.find((e=>e.name.toLowerCase()==r[1]))||e.find((e=>e.name.toLowerCase()==r[1])))return o("ERROR Command already exists!");e.push({name:r[1],tag:r[2],description:"No description",category:"Uncategorized"}),m.set("Cmds",JSON.stringify(e)),o("SUCCESS Command added!");break;case"remove":if(r.length<2)return o("ERROR You must include a command name");let a=e.find((e=>e.name==r[1]));if(!a)return o("ERROR Command not found");e=e.filter((e=>e.name!=a.name)),m.set("Cmds",JSON.stringify(e)),o("SUCCESS Command removed!");break;case"raw":o(`TEXT ${JSON.stringify(JSON.parse(m.get("Cmds","[]")),null,2)}`)}}}})}